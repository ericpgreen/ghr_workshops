---
title: "Causal Inference Workshop"
subtitle: "Eldoret, June 2023"
author:
  - Eric Green
format: 
  revealjs:
    multiplex: true
    theme: [custom.scss]
    slide-number: c/t
    incremental: true
    progress: true
    title-slide-attributes:
      data-background-image: img/title.png
      data-background-size: contain
      data-background-opacity: "1"
---

```{r, include=FALSE}
library(countdown)

# image slides
# https://docs.google.com/presentation/d/1QrB7gPmjOm-lIvvHrG0J3DdVXLNAcOYH2zqcjaKlsTY/edit?usp=sharing
```

##  {background-image="img/FallMini2022-11.jpg"}

## Today's Agenda

::: columns
::: {.column width="90%"}
| Time        | Topic                             |
|-------------|:----------------------------------|
| 10:00-10:30 | The challenge of causal inference |
| 10:30-11:00 | Confounder control and causal diagrams |
| 11:00-11:10 | ‚òïÔ∏è Coffee/tea break               |
| 11:10-12:00 | Malaria DAG                       |

:::
:::


## Thursday and Friday ü§ù

Available for 1-on-1s or small group consultation. Sign-up for a slot at [ghr.link/meeting-eld23](https://ghr.link/meeting-eld23)

![](img/QR_meeting.png)

##  {background-image="img/coffee.png"}

## Observational Findings

[Ding et al. (2015)](https://www.ahajournals.org/doi/10.1161/CIRCULATIONAHA.115.017341) conducted a pooled analysis of three large prospective cohort studies of health professionals in the U.S. (95% white) followed for up to 36 years:

> Higher consumption of total coffee, caffeinated coffee, and decaffeinated coffee was associated with lower risk of total mortality‚Ä¶Relative to no consumption of coffee, the pooled hazard ratio for death was 0.95 (95% confidence interval [CI], 0.91‚Äì0.99) for 1.0 or less cup of total coffee per day.

In other words, the sort of people who drink a cup of coffee daily have a 5% lower risk of dying over 2 to 3 decades. 

## Causal Deniability

Does this mean that coffee prevents death? The study authors say no. But also, maybe!

**Step 1: Avoid the word ‚Äúcausal‚Äù and warn that correlation is not causation.**

> ‚Ä¶given the observational nature of the study design, we could not directly establish a cause-effect relationship between coffee and mortality.

## Causal Deniability

Does this mean that coffee prevents death? The study authors say no. But also, maybe!

[Step 1: Avoid the word "causal" and warn that correlation is not causation.]{style="color:rgba(178, 190, 181);"}

**Step 2: Ignore the warning and make policy or health recommendations based on a causal interpretation of the findings.**

> ‚Ä¶coffee consumption can be incorporated into a healthy lifestyle‚Ä¶moderate consumption of coffee may confer health benefits in terms of reducing premature death.


```{r}
countdown(minutes = 1, seconds = 00, top = 0)
```

## So which is it, a non-causal association or a causal effect? 

[Hern√°n (2018)](https://ajph.aphapublications.org/doi/full/10.2105/AJPH.2018.304337) argues that scientists need to stop the charade:

> We need to stop treating "causal" as a dirty word that respectable investigators do not say in public or put in print. It is true that observational studies cannot definitely prove causation, but this statement misses the point‚Ä¶

According to Hern√°n, the point is that we have to be clear about our scientific goals and use language that reflects these goals. 

## What is our goal? What do we want to know?
<br>

[A. Whether the sort of people who drink a cup of coffee daily have a lower risk of dying]{style="font-size:150%;" .fragment}

[B. Whether drinking a cup of coffee daily lowers the risk of dying?]{style="font-size:150%;" .fragment}


## What is our goal? What do we want to know?
<br>

[A. Whether the sort of people who drink a cup of coffee daily have a lower risk of dying]{style="font-size:150%; color:rgba(178, 190, 181);"}

[B. Whether drinking a cup of coffee daily lowers the risk of dying?]{style="font-size:150%; background-color:rgba(244, 186, 2);"}

## To answer this question we need causal inference
<br>

[A. Whether the sort of people who drink a cup of coffee daily have a lower risk of dying]{style="font-size:150%; color:rgba(178, 190, 181);"}

[B. Whether drinking a cup of coffee daily lowers the risk of dying?]{style="font-size:150%; background-color:rgba(244, 186, 2);"}


# [Causal Inference]{style="color:white; font-size:200%;"} {background="linear-gradient(0deg, #00529b, #1f9ac9)"}

## Causal Inference

Causal inference is what we do when we identify and estimate the causal effect of some proposed cause on an outcome of interest.

<center>
![](img/causeeffect.png)
</center>

## Counterfactual Thinking

[Causal inference is an exercise in counterfactual thinking, full of "what if" questions about the road not taken.]{style="font-size:150%; background-color:rgba(244, 186, 2);"}

A counterfactual is the hypothetical state of a "what if" question. With counterfactual thinking, there is what actually happened, and then there is the hypothetical counterfactual of what would have happened, counter to fact, under the alternative scenario. The difference between what did happen and what would have happened is a known as the causal effect.

## {background-image="img/road less traveled 0.svg"}
## {background-image="img/road less traveled 1.svg"}
## {background-image="img/road less traveled 2.svg"}
## {background-image="img/road less traveled 3.svg"}
## {background-image="img/road less traveled 4.svg"}

## {background-image="img/po.png"}

## Back to Reality

We're not all knowing, of course, and we only get to observe one potential outcome for each person. This means we have to estimate the ATE by comparing people like Robert who take the road less traveled to people who take the road more traveled. But how do people come to take one road versus the other? 


```{r}
countdown(minutes = 1, seconds = 00, bottom = 0)
```

## Who Gets "Treated"?

Let's consider two scenarios:

1. Travelers are **randomly assigned** to a road. They come to the fork in the road and pull directions out of a hat. 
2. Travelers **select** a road themselves. They go with their gut and all happen to pick the road that maximizes their individual happiness. 

## {background-image="img/po2.png"}

## Randomization Neutralizes Selection Bias...

The simple difference in outcomes between groups consists of the average treatment effect + bias. Under perfect randomization, there is no bias, so the difference in outcomes is just the ATE.

## ...But Randomization is Not Always Possible or Maintained

Most research is non-experimental, or what many would call observational. Selection bias is always a concern in these studies. Our only defense against being fooled by selection bias is research design and statistical adjustment. As [Cunningham (2020)](https://mixtape.scunning.com/) states:

> One could argue that the entire enterprise of causal inference is about developing a reasonable strategy for negating the role that selection bias is playing in estimated causal effects.

## Causal Inference Methods

[Matthay et al. (2020)](https://pubmed.ncbi.nlm.nih.gov/31890846/) divide non-experimental approaches to causal inference into two main buckets: confounder-control and instrument-based.[^others] 

**Confounder-control** is characterized by the use of statistical adjustment to make groups more comparable.

**Instrument-based studies**, sometimes called **quasi-experimental designs**, estimate treatment effects by finding and leveraging arbitrary reasons why some people are more likely to be treated or exposed.

[^others]: You might also come across references to Bradford Hill's Considerations and the sufficient-component cause model.

# [Causal Diagrams and Confounder Control]{style="color:white; font-size:150%;"} {background="linear-gradient(0deg, #00529b, #1f9ac9)"}

## {background-image="img/road less traveled 5.svg"}

## Data Are Dumb

As Pearl and Mackenzie tell us in the [*Book of Why*](https://amzn.to/3CKyjnP), cofounder control is not just an exercise in statistics because data are profoundly dumb. A dataset cannot tell us which variables to adjust for, or what is a cause and what is an effect. For that we need information that lives outside of statistical models. We need causal models that are informed by domain expertise ([McElreath, 2020](https://amzn.to/3FdX2mk)).

## DAG {background-image="img/dag example.svg" background-size="99%" background-color="white"}

## {background-image="img/road less traveled 6.svg"}
## {background-image="img/road less traveled 7.svg"}
## {background-image="img/road less traveled 8.svg"}
## {background-image="img/road less traveled 9.svg"}
## {background-image="img/road less traveled 10.svg"}
## {background-image="img/road less traveled 11.svg"}

## {background-image="img/road less traveled 12.svg"}

```{r}
countdown(minutes = 2, seconds = 00, top = 0, left = 1)
```

## {background-image="img/road less traveled 13.svg"}

## Effect Identification

Next we need to determine which paths are good and which are bad ([Huntington-Klein, 2021](https://theeffectbook.net/)). "Good paths" identify our research question. "Bad paths" are the alternate explanations for the causal effect that we need to close. In our example DAG, as in many DAGS, good paths often start with an arrow exiting the proposed cause and bad paths have arrows entering the proposed cause.

```{r}
countdown(minutes = 1, seconds = 00, bottom = 0)
```

## {background-image="img/road dag paths.svg" background-size="99%" background-color="white"}

## {background-image="img/road less traveled 14.svg"}
## {background-image="img/road less traveled 15.svg"}
## {background-image="img/road less traveled 16.svg"}

## Simulated Example (ATE=1.5) {background-image="img/fig-confounding-1.png" background-size="99%" background-color="white"}

## {background-image="img/road less traveled 17.svg"}
## {background-image="img/road less traveled 18.svg"}

## ‚òïÔ∏è Coffee/tea break

```{r}
countdown(minutes = 10, seconds = 00, bottom = 0)
```
